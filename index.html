<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Açık Hava Basıncı – Basit Ortaokul Sürümü (v8 + Onboarding)</title>
<style>
  :root{
    --bg:#fff; --panel:#f6f8fb; --border:#e5e7eb; --text:#111827; --muted:#6b7280;
    --accent:#2563eb; --warn:#ef4444; --ok:#16a34a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
       font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .app{max-width:1100px;margin:20px auto;padding:0 12px;
       display:grid;grid-template-columns:minmax(520px,1.2fr) minmax(380px,1fr);gap:16px}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px}
  .stage{position:relative}
  .stage canvas{width:100%;aspect-ratio:4/3;display:block;background:#fff;border:1px solid var(--border);border-radius:10px}
  .panel h3{margin:6px 0 10px 0;font-size:18px}
  .kpis{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .kpi{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px}
  .kpi .t{font-size:13px;color:var(--muted)}
  .kpi .v{font-size:24px;font-weight:800}
  .row{display:flex;align-items:center;gap:10px;margin:10px 0}
  .row label{min-width:108px;color:var(--muted)}
  input[type=range]{width:100%}
  .preset{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .btn{border:1px solid var(--border);background:#fff;padding:7px 10px;border-radius:10px;cursor:pointer}
  .btn:hover{background:#f3f4f6}
  #chart{width:100%;height:160px;background:#fff;border:1px solid var(--border);border-radius:10px}
  .hint{font-size:13px;color:var(--muted);background:#fff;border:1px dashed var(--border);border-radius:10px;padding:8px}

  /* === Onboarding / Tur === */
  .ob-backdrop{position:fixed;inset:0;background:rgba(17,24,39,.55);display:flex;align-items:center;justify-content:center;z-index:1100}
  .ob-backdrop[hidden]{display:none !important}
  .ob-card{background:#fff;border:1px solid var(--border);border-radius:14px;max-width:520px;width:92%;padding:16px}
  .ob-card h2{margin:0 0 6px 0;font-size:22px}
  .ob-card ul{margin:6px 0 0 20px;padding:0}
  .ob-card li{margin:4px 0}
  .ob-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
  .ghost{background:#fff;border:1px solid var(--border)}
  .primary{background:var(--accent);border:1px solid var(--accent);color:#fff}

  /* Tur katmanı tıklanabilir; sadece spot tıklama almaz */
  .tour-overlay{position:fixed;inset:0;z-index:1000;pointer-events:auto;display:none}
  .tour-spot{position:fixed;box-shadow:0 0 0 9999px rgba(0,0,0,.55);border-radius:12px;transition:all .25s ease;pointer-events:none}
  .tour-tip{position:fixed;max-width:320px;background:#fff;border:1px solid var(--border);border-radius:10px;padding:12px;z-index:1101;pointer-events:auto}
  .tour-title{font-weight:700;margin:0 0 6px 0}
  .tour-ctrl{display:flex;gap:8px;justify-content:space-between;margin-top:8px}
  .fab{position:fixed;right:18px;bottom:18px;z-index:20;border-radius:999px;padding:10px 12px;background:#fff;border:1px solid var(--border);box-shadow:0 2px 8px rgba(0,0,0,.06);cursor:pointer}
  .fab:hover{background:#f3f4f6}

  @media (max-width:980px){ .app{grid-template-columns:1fr} }
</style>
</head>
<body>
  <main class="app" id="appRoot">
    <!-- SOL: SAHNE -->
    <section class="card stage" aria-label="Simülasyon Sahnesi">
      <canvas id="stage"></canvas>
    </section>

    <!-- SAĞ: KONTROLLER -->
    <aside class="card panel" id="panel">
      <div class="kpis" id="kpiBox">
        <div class="kpi" id="kpiAtmBox"><div class="t">🌍 Atmosfer Basıncı (atm)</div><div class="v" id="kpiAtm">1.00</div></div>
        <div class="kpi" id="kpiBoilBox"><div class="t">🔥 Kaynama Noktası (°C)</div><div class="v" id="kpiBoil">100.0</div></div>
        <div class="kpi"><div class="t">⛰️ Rakım (m)</div><div class="v" id="kpiAlt">0</div></div>
        <div class="kpi"><div class="t">Δh (U-manometre, mmHg)</div><div class="v" id="kpiDh">0</div></div>
      </div>

      <h3>Kontroller</h3>
      <div class="row" id="rowAlt">
        <label for="slAlt">Rakım</label>
        <input id="slAlt" type="range" min="0" max="9000" step="100" value="0">
        <span id="altVal">0 m</span>
      </div>
      <div class="row" id="rowDP">
        <label for="slDP">Hava ΔP</label>
        <input id="slDP" type="range" min="-20" max="20" step="1" value="0">
        <span id="dpVal">0 hPa</span>
      </div>
      <div class="preset" id="presetBox">
        <button class="btn" data-alt="0" data-dp="0">Deniz Seviyesi</button>
        <button class="btn" data-alt="1500" data-dp="-5">Yayla</button>
        <button class="btn" data-alt="3000" data-dp="-10">Dağ</button>
        <button class="btn" data-alt="5000" data-dp="-15">Zirve</button>
      </div>

      <h3 id="chartTitle">Rakım–Basınç Eğrisi</h3>
      <canvas id="chart"></canvas>

      <p class="hint">Rakım ↑ → <b>basınç</b> ↓ → suyun <b>kaynama sıcaklığı</b> ↓. Hava ΔP değeri, yüksek/alçak basınç sistemlerini (±hPa) temsil eder.</p>
    </aside>
  </main>

  <!-- Yardım Turu butonu -->
  <button id="btnHelp" class="fab" aria-label="Yardım Turu">?</button>

  <!-- Onboarding karşılama -->
  <div id="ob" class="ob-backdrop" hidden>
    <div class="ob-card" role="dialog" aria-modal="true" aria-labelledby="obTitle">
      <h2 id="obTitle">Açık Hava Basıncı Simülasyonu</h2>
      <p>2 kaydırıcı ile ortam basıncını değiştir, ekrandaki göstergeleri gözlemle:</p>
      <ul>
        <li><b>Rakım</b> artarsa basınç azalır.</li>
        <li><b>Hava ΔP</b> (hPa): yüksek/alçak basınç sistemleri.</li>
        <li>Basınç düşünce <b>kaynama sıcaklığı</b> da düşer.</li>
      </ul>
      <div class="ob-actions">
        <button id="obSkip" class="btn ghost">Geç</button>
        <button id="obStart" class="btn primary">Tura Başla</button>
      </div>
    </div>
  </div>

  <!-- Rehber tur katmanları -->
  <div id="tour" class="tour-overlay" aria-hidden="true">
    <div id="spot" class="tour-spot"></div>
    <div id="tip" class="tour-tip" role="dialog" aria-modal="true" aria-live="polite">
      <div class="tour-title" id="tipTitle"></div>
      <div id="tipBody"></div>
      <div class="tour-ctrl">
        <button id="tourPrev" class="btn">Geri</button>
        <div style="flex:1"></div>
        <button id="tourSkip" class="btn ghost">Atla</button>
        <button id="tourNext" class="btn primary">İleri</button>
      </div>
    </div>
  </div>

<script>
/* ===== Basit Fizik Yardımcıları ===== */
const P0=101325,H=8400,ATM=101325,HPA=100,MMHG=133.322;
const paAt=(alt_m,dP_hPa)=>P0*Math.exp(-alt_m/H)+dP_hPa*HPA;
const atmAt=(alt_m,dP_hPa)=>paAt(alt_m,dP_hPa)/ATM;
function boilC_from_atm(p_atm){const A=8.07131,B=1730.63,C=233.426;const Pmm=p_atm*760;return B/(A-Math.log10(Pmm))-C;}

/* ===== Durum ===== */
const state={alt:0,dP:0,atm:1.0,boil:100,dh:0};

/* ===== Kanvas yardımcıları ===== */
function fitCanvas(el){const dpr=Math.max(1,window.devicePixelRatio||1);const r=el.getBoundingClientRect();el.width=Math.round(r.width*dpr);el.height=Math.round(r.height*dpr);const ctx=el.getContext('2d');ctx.setTransform(dpr,0,0,dpr,0,0);return ctx;}

/* ===== Elemanlar ===== */
const stage=document.getElementById('stage'); const chart=document.getElementById('chart');
let sctx=fitCanvas(stage); let cctx=fitCanvas(chart);
const slAlt=document.getElementById('slAlt'); const slDP=document.getElementById('slDP');
const altVal=document.getElementById('altVal'); const dpVal=document.getElementById('dpVal');
const kpiAtm=document.getElementById('kpiAtm'); const kpiBoil=document.getElementById('kpiBoil');
const kpiAlt=document.getElementById('kpiAlt'); const kpiDh=document.getElementById('kpiDh');

/* ===== Çizimler ===== */
function roundRect(ctx,x,y,w,h,r){ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);}
function drawStage(){
  const w=stage.getBoundingClientRect().width, h=stage.getBoundingClientRect().height;
  sctx.clearRect(0,0,w,h);
  // Atmosfer sütunu
  const colX=18,colY=18,colW=90,colH=h-36;
  const grad=sctx.createLinearGradient(0,colY,0,colY+colH);
  grad.addColorStop(0,'rgba(37,99,235,0.15)'); grad.addColorStop(1,'rgba(37,99,235,0.65)');
  sctx.fillStyle='#fff'; sctx.strokeStyle='#e5e7eb'; sctx.lineWidth=1;
  sctx.beginPath(); roundRect(sctx,colX,colY,colW,colH,12); sctx.fill(); sctx.stroke();
  sctx.fillStyle=grad; sctx.beginPath(); roundRect(sctx,colX+6,colY+6,colW-12,colH-12,10); sctx.fill();
  sctx.fillStyle='#6b7280'; sctx.font='12px system-ui'; sctx.fillText('Atmosfer', colX+8, colY-4);

  // U-manometre
  const baseY=h-30, topY=30, left=colX+colW+24, right=left+44, rad=10;
  const dh_mm = state.dh, scale=0.45, maxLeg=baseY-topY-18, dPix=Math.max(-maxLeg,Math.min(maxLeg,dh_mm*scale));
  sctx.strokeStyle='#cbd5e1'; sctx.lineWidth=8; sctx.lineCap='round';
  sctx.beginPath(); sctx.moveTo(left,topY); sctx.lineTo(left,baseY-rad); sctx.arc((left+right)/2,baseY-rad,(right-left)/2-2,Math.PI,0); sctx.lineTo(right,topY); sctx.stroke();
  sctx.strokeStyle='#2563eb'; sctx.lineWidth=8; sctx.beginPath();
  sctx.moveTo(left,baseY); sctx.lineTo(left,baseY-70 + dPix/2);
  sctx.moveTo(right,baseY); sctx.lineTo(right,baseY-70 - dPix/2); sctx.stroke();
  sctx.fillStyle='#111827'; sctx.font='12px system-ui'; sctx.fillText(`Δh ≈ ${Math.abs(dh_mm).toFixed(0)} mmHg`, (left+right)/2-42, topY-8);

  // Kadran
  const cx=w-120, cy=90, R=62, a0=Math.PI*0.75, a1=Math.PI*0.25;
  sctx.fillStyle='#fff'; sctx.strokeStyle='#e5e7eb'; sctx.beginPath(); sctx.arc(cx,cy,R+14,0,Math.PI*2); sctx.fill(); sctx.stroke();
  for(let i=0;i<=10;i++){ const a=a0+(a1-a0)*(i/10), r0=R-8, r1=R+4;
    sctx.beginPath(); sctx.moveTo(cx+r0*Math.cos(a), cy+r0*Math.sin(a)); sctx.lineTo(cx+r1*Math.cos(a), cy+r1*Math.sin(a));
    sctx.strokeStyle='#9ca3af'; sctx.lineWidth=(i%5===0)?2:1; sctx.stroke();
  }
  const atm=Math.max(0,Math.min(1.1,state.atm)); const ang=a0+(a1-a0)*(atm/1.1);
  sctx.strokeStyle='#ef4444'; sctx.lineWidth=3;
  sctx.beginPath(); sctx.moveTo(cx-6*Math.cos(ang), cy-6*Math.sin(ang)); sctx.lineTo(cx+(R-2)*Math.cos(ang), cy+(R-2)*Math.sin(ang)); sctx.stroke();
  sctx.fillStyle='#111827'; sctx.beginPath(); sctx.arc(cx,cy,5,0,Math.PI*2); sctx.fill();
  sctx.fillStyle='#111827'; sctx.font='13px system-ui';
  sctx.fillText(`P_atm = ${state.atm.toFixed(2)} atm`, cx-62, cy+R+24);
  sctx.fillText(`Kaynama ≈ ${state.boil.toFixed(1)} °C`, cx-74, cy+R+42);
}
function drawChart(){
  const w=chart.getBoundingClientRect().width, h=chart.getBoundingClientRect().height;
  cctx.clearRect(0,0,w,h);
  cctx.fillStyle='#fff'; cctx.strokeStyle='#e5e7eb'; roundRect(cctx,8,8,w-16,h-16,10); cctx.fill(); cctx.stroke();
  const left=28,right=w-28,top=22,bottom=h-26;
  cctx.strokeStyle='#e5e7eb'; for(let i=0;i<=4;i++){ const y=bottom-(bottom-top)*i/4; cctx.beginPath(); cctx.moveTo(left,y); cctx.lineTo(right,y); cctx.stroke();}
  const maxAlt=9000,N=60; cctx.beginPath();
  for(let i=0;i<=N;i++){ const alt=i/N*maxAlt; const atm=atmAt(alt,state.dP);
    const x=left+(right-left)*i/N; const y=bottom-(bottom-top)*(Math.max(0,Math.min(1.1,atm))/1.1);
    i===0?cctx.moveTo(x,y):cctx.lineTo(x,y);
  }
  cctx.strokeStyle='#2563eb'; cctx.lineWidth=2; cctx.stroke();
  const xM = left+(right-left)*(state.alt/maxAlt);
  const yM = bottom-(bottom-top)*(Math.max(0,Math.min(1.1,state.atm))/1.1);
  cctx.fillStyle='#ca8a04'; cctx.beginPath(); cctx.arc(xM,yM,4,0,Math.PI*2); cctx.fill();
  cctx.fillStyle='#6b7280'; cctx.font='12px system-ui';
  cctx.fillText('Rakım (m)', w/2-32, h-6); cctx.save(); cctx.translate(12,h/2); cctx.rotate(-Math.PI/2);
  cctx.fillText('Basınç (atm)', -34,0); cctx.restore();
}

/* ===== Hesapla + UI güncelle ===== */
function recalc(){
  state.atm = atmAt(state.alt,state.dP);
  state.boil= boilC_from_atm(state.atm);
  state.dh  = (P0 - paAt(state.alt,state.dP))/MMHG;
  kpiAtm.textContent=state.atm.toFixed(2);
  kpiBoil.textContent=state.boil.toFixed(1);
  kpiAlt.textContent=Math.round(state.alt);
  kpiDh.textContent =Math.abs(state.dh).toFixed(0);
  altVal.textContent=`${Math.round(state.alt)} m`;
  dpVal.textContent =`${Math.round(state.dP)} hPa`;
  drawStage(); drawChart();
}

/* ===== Etkileşim ===== */
slAlt.addEventListener('input',e=>{state.alt=+e.target.value; recalc();});
slDP .addEventListener('input',e=>{state.dP =+e.target.value; recalc();});
document.querySelectorAll('.preset .btn').forEach(btn=>btn.addEventListener('click',()=>{
  state.alt=+btn.dataset.alt; state.dP=+btn.dataset.dp; slAlt.value=state.alt; slDP.value=state.dP; recalc();
}));
window.addEventListener('resize',()=>{sctx=fitCanvas(stage); cctx=fitCanvas(chart); drawStage(); drawChart();});

/* ===== Başlat ===== */
(function init(){ state.alt=+slAlt.value; state.dP=+slDP.value; recalc(); })();

/* ===== Mini Self-Tests (konsol) ===== */
(function tests(){
  const near=(a,b,e)=>Math.abs(a-b)<=e; console.log('%cSelf-test…','color:#2563eb');
  console.assert(near(atmAt(0,0),1.00,0.02),'Deniz seviyesi ~1 atm');
  console.assert(near(atmAt(8400,0),Math.E**-1,0.03),'H≈8400 m → e^-1 atm');
  console.assert(near(boilC_from_atm(1.0),100,1.2),'1 atm → ~100°C');
  console.assert((P0 - paAt(0,0))/MMHG < 0.5,'Δh≈0 mmHg deniz seviyesinde');
})();

/* ===== Onboarding & Tur ===== */
const ob=document.getElementById('ob'); const obStart=document.getElementById('obStart'); const obSkip=document.getElementById('obSkip');
const tour=document.getElementById('tour'); const spot=document.getElementById('spot'); const tip=document.getElementById('tip');
const tipTitle=document.getElementById('tipTitle'); const tipBody=document.getElementById('tipBody');
const btnPrev=document.getElementById('tourPrev'); const btnNext=document.getElementById('tourNext'); const btnSkip=document.getElementById('tourSkip');
const btnHelp=document.getElementById('btnHelp');

let step=0;
const steps=[
  {sel:'#rowAlt', title:'1) Rakım', body:'Sürgüyü sağa çek. Rakım arttıkça atmosfer basıncı düşer.',
   onEnter:()=>{slAlt.value=3000; state.alt=3000; recalc();}},
  {sel:'#rowDP', title:'2) Hava ΔP (hPa)', body:'Alçak basınç için değeri negatif yap. Bu da basıncı düşürür.',
   onEnter:()=>{slDP.value=-10; state.dP=-10; recalc();}},
  {sel:'#kpiBox', title:'3) Göstergeler', body:'P_atm ve Kaynama Noktası anlık güncellenir. Basınç azalınca kaynama sıcaklığı düşer.'},
  {sel:'#chart', title:'4) Rakım–Basınç Eğrisi', body:'Eğri genel ilişkiyi gösterir. Sarı nokta seçili rakımı belirtir.'}
];

function placeSpot(el){
  const r=el.getBoundingClientRect(), pad=8;
  spot.style.left=(r.left-pad)+'px';
  spot.style.top =(r.top-pad+window.scrollY)+'px';
  spot.style.width =(r.width+pad*2)+'px';
  spot.style.height=(r.height+pad*2)+'px';
}
function placeTip(el){
  const r=el.getBoundingClientRect(); const tw=320, th=120;
  let x=r.right+12, y=r.top+window.scrollY;
  if(x+tw>window.innerWidth-12) x=r.left-tw-12;
  if(x<12) x=12;
  if(y+th>window.scrollY+window.innerHeight-12) y=r.bottom+window.scrollY-th-12;
  tip.style.left=x+'px'; tip.style.top=y+'px';
}
function showStep(i){
  step=i;
  const el=document.querySelector(steps[i].sel);
  if(!el) return endTour();
  el.scrollIntoView({behavior:'smooth', block:'center'});
  setTimeout(()=>{
    placeSpot(el); placeTip(el);
    tipTitle.textContent=steps[i].title;
    tipBody.textContent =steps[i].body;
    steps[i].onEnter && steps[i].onEnter();
    btnPrev.disabled = (i===0);
    btnNext.textContent = (i===steps.length-1)? 'Bitir' : 'İleri';
  }, 250);
}
function startTour(){ tour.style.display='block'; tour.setAttribute('aria-hidden','false'); showStep(0); }
function endTour(markSeen=true){ tour.style.display='none'; tour.setAttribute('aria-hidden','true'); if(markSeen) try{localStorage.setItem('onboard_v8_done','1');}catch{} }

// Tur açıkken reposition
window.addEventListener('resize', ()=>{ if(tour.getAttribute('aria-hidden')==='false') showStep(step); });
window.addEventListener('scroll', ()=>{ if(tour.getAttribute('aria-hidden')==='false') showStep(step); }, {passive:true});

btnPrev.onclick = ()=> showStep(Math.max(0, step-1));
btnNext.onclick = ()=>{ if(step<steps.length-1) showStep(step+1); else endTour(); };
btnSkip.onclick = ()=> endTour();
btnHelp.onclick = ()=>{ startTour(); };

obStart.onclick = ()=>{ ob.hidden=true; ob.style.display='none'; startTour(); };
obSkip.onclick  = ()=>{ ob.hidden=true; ob.style.display='none'; try{localStorage.setItem('onboard_v8_done','1');}catch{} };

// İlk açılışta karşılama (güvenli)
try {
  if(localStorage.getItem('onboard_v8_done')!=='1'){ ob.hidden=false; ob.style.display='flex'; }
} catch { ob.hidden=false; ob.style.display='flex'; }

// ESC ile kapat
window.addEventListener('keydown',e=>{ if(e.key==='Escape'){ ob.hidden=true; ob.style.display='none'; endTour(false);} });
</script>
</body>
</html>





